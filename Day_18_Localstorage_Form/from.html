<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Form</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container">
        <div class="row">
            <div class="col-md-6 mx-auto">
                <form action="" method="post" id="form">
                    <h2>Test Local Storage</h2>
                    <div class="mb-3">
                        <label for="p_name" class="form-label">Product Name</label>
                        <input type="text" id="p_name" class="form-control"/>
                    </div>
                    <div class="mb-3">
                        <label for="p_price" class="form-label">Price</label>
                        <input type="text" id="p_price" class="form-control"/>
                    </div>
                    <div class="mb-3">
                        <label for="p_qty" class="form-label">Qty</label>
                        <input type="text" id="p_qty" class="form-control"/>
                    </div>
                    <button class="btn btn-primary">Add Data</button>
                </form>
            </div>
        </div>

        <div class="row mx-auto w-50">
            <div class="col-12">
                <table id="myTable" class="table table-dark table-striped table-hover table-bordered caption-top">
                    <caption>
                        <h2>Product Data</h2>
                    </caption>
                    <thead>
                        <tr>
                            <th>Product Name</th>
                            <th>Price</th>
                            <th>Qty</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Data will be added here  -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        let form = document.querySelector('#form');
        let table = document.querySelector('#myTable tbody');
        let inputs = document.querySelectorAll('#form input');
        let item = {};
        let list = JSON.parse(localStorage.getItem("list") || []);
        let editId = null;

        inputs[0].focus();
        inputs.forEach((input) => {
            input.addEventListener("input", (e) => {
                let {name , value} = e.target;
                item = { ...item , [name] : value};
            });
        });

        form.addEventListener("submit",(event) => {
            event.preventDefault();

            if(editId == null) {
                list.push({...item, id:Date.now()});
            }else {
                list = list.map((product) => {
                    if(product.id == editId) {
                        return{...product, ...item};
                    }
                    return product;
                });
                editId = null;
            }

            DisplayProduct();
            localStorage.setItem("list",JSON.stringify(list));
            inputs.forEach((input,index) => {
                input.value = "";
            });
            inputs[0].focus(); 
        });

        const DisplayProduct = () => {
            table.innerHTML = "";
            list.forEach((product,index) => {
                let row = document.createElement('tr');
                let col = document.createElement('td');

                for(let key in product) {
                    if(key !== "id") {
                        let col = document.createElement('td');
                        col.innerText = product[key];
                        row.appendChild(col);
                    }
                }

                col.innerHTML = `
                    <td>
                        <button class = "btn btn-danger" onclick = "handleDelete(${product.id})">Delete</button>
                        <button class = "btn btn-warning" onclick = "handleEdit(${product.id})">Edit</button>
                    </td>`;

                row.appendChild(col);
                table.appendChild(row);
            });
        };

        const handleDelete = (id) => {
            list = list.filter((product) => product.id !== id);
            DisplayProduct();
            localStorage.setItem("list",JSON.stringify(list));
        }

        const handleEdit = (id) => {
            let data = list.find((product) => product.id === id);
            let keys = Object.keys(data);

            keys.forEach((key,index) => {
                if(index != keys.length - 1) {
                    inputs[index].value = data[key];
                }
            })
            editId = id;
            item = data;
        }

        DisplayProduct();
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>